C51 COMPILER V9.60.0.0   UART                                                              07/02/2021 22:57:54 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN .\Objects\uart.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE uart.c OMF2 OPTIMIZE(8,SPEED) BROWSE DEBUG PRINT(.\Listings\uart.lst) OBJEC
                    -T(.\Objects\uart.obj)

line level    source

   1          #include <regx52.h>
   2          #include "ChineseGBK.h"
   3          
   4          //------------------ä¸²å£é€šä¿¡çš„æ•°æ®åŒ…åè®®-----------------//
   5          /*
   6                  æ­¤ç¨‹åºçš„ä¸²å£å­—ç¬¦ä¸²é€šä¿¡ä½¿ç”¨åˆ°ä¸‹é¢çš„ä¸€ä¸ªè‡ªå®šä¹‰åè®®ï¼Œæ¯æ¬¡é€šä¿¡éƒ½æ˜¯å‘é€æˆ–æ¥
             -æ”¶ä¸€ä¸ªæ•°æ®åŒ…ï¼Œæ•°æ®åŒ…æ ¼å¼è§£é‡Šå¦‚ä¸‹(é•¿åº¦æ’ä¸º15):
   7                  ä¾‹å¦‚:A01_fmq_01Off___#
   8                  A--------æ•°æ®åŒ…çš„å¼€å§‹æ ‡è®°(å¯ä»¥ä¸ºAåˆ°Z,æ„å‘³ç€æ•°æ®åŒ…å¯ä»¥æœ‰26ç§)
   9                  01-----è®¾å¤‡ä»£å·
  10                  fmq_01Off___--------æŒ‡ä»¤(é•¿åº¦æ’ä¸º10)ï¼ŒæŒ‡ä»¤çš„å‰4ä¸ªäººå­—ç¬¦æ˜¯æŒ‡ä»¤å¤´éƒ¨ï¼ŒæŒ‡ä»¤çš„å6ä¸ªå
             -­—ç¬¦æ˜¯æŒ‡ä»¤å°¾éƒ¨
  11                  #---------æ•°æ®åŒ…çš„ç»“æŸæ ‡è®°
  12          
  13                  ä¾‹å¦‚:A02_SenT010250#
  14                  A--------æ•°æ®åŒ…çš„å¼€å§‹æ ‡è®°(å¯ä»¥ä¸ºAåˆ°Z,æ„å‘³ç€æ•°æ®åŒ…å¯ä»¥æœ‰26ç§)
  15                  02-----è®¾å¤‡ä»£å·
  16                  SenT010250--------æŒ‡ä»¤(é•¿åº¦æ’ä¸º10)ï¼ŒæŒ‡ä»¤çš„å‰4ä¸ªäººå­—ç¬¦æ˜¯æŒ‡ä»¤å¤´éƒ¨ï¼ŒæŒ‡ä»¤çš„å6ä¸ªå­—
             -ç¬¦æ˜¯æŒ‡ä»¤å°¾éƒ¨
  17                  #---------æ•°æ®åŒ…çš„ç»“æŸæ ‡è®°
  18          */
  19          #define LENGTH 20
  20          char xdata RecvString_buf[LENGTH]; //å®šä¹‰æ•°æ®åŒ…é•¿åº¦ä¸º19ä¸ªå­—ç¬¦
  21          
  22          //è¿™ä¸ªæ˜¯æ›¾ç»ç”¨æ¥æ§åˆ¶æ¸©åº¦ä¼ æ„Ÿæ¨¡å—ï¼ˆDS18B20ï¼‰çš„æ•°æ®åŒ…
  23          //æˆ‘éšä¾¿å®šä¹‰äº†ä¸€ä¸ªæ•°æ®åŒ…ç”¨æ¥åš"å¿ƒè·³åŒ…"ï¼Œæ¯”å¦‚å•ç‰‡æœºç³»ç»Ÿå‘ç”µè„‘æ¯2ç§’å‘é€ä¸€æ¬
             -¡è¯¥æ•°æ®åŒ…ï¼Œå¦‚æœç”µè„‘æ²¡æœ‰æŒ‰æ—¶æ¥æ”¶åˆ°ï¼Œå°±è®¤ä¸ºå•ç‰‡æœºæ­»æ‰äº†
  24          //----------------------------------------------//
  25          /*******************************
  26                                  ä¸²å£é€šä¿¡
  27                  MCU:89C52RC        11.0592MHz
  28          
  29          //11.0592MHz 0xd0 1200bps
  30          //12MHz 0xcc 1200bps
  31          //11.0592MHz 0xfa 9600bps
  32          //0xf4 11.0592MHz  0xf3 12MHz 4800bps
  33          //å‡åœ¨SMOD=1çš„æƒ…å†µä¸‹ï¼ˆæ³¢ç‰¹ç‡å€å¢æ¨¡å¼ï¼‰
  34          *******************************/
  35          //ä¸²å£å‘é€å‡½æ•°
  36          void PutString(unsigned char *TXStr) {
  37   1              ES = 0;
  38   1              while (*TXStr != 0) {
  39   2                      SBUF = *TXStr;
  40   2                      while (TI == 0);
  41   2                      TI = 0;
  42   2                      TXStr++;
  43   2              }
  44   1              ES = 1;
  45   1      }
  46          //ä¸²å£æ¥æ”¶å‡½æ•°
  47          bit ReceiveString() {
  48   1              char *RecStr = RecvString_buf;
  49   1              char num = 0;
  50   1              unsigned char count = 0;
C51 COMPILER V9.60.0.0   UART                                                              07/02/2021 22:57:54 PAGE 2   

  51   1              while (1) {
  52   2                      bit flag = 0;
  53   2                      *RecStr = SBUF;
  54   2                      count = 0;
  55   2                      RI = 0;
  56   2                      num++;
  57   2                      RecStr++;
  58   2                      while (!RI) {
  59   3                              count++;
  60   3                              if (count > 130) { //æ¥æ”¶æ•°æ®ç­‰å¾…å»¶è¿Ÿï¼Œç­‰å¾…æ—¶é—´å¤ªä¹…ä¼šå¯¼è‡´CPUè¿ç®—é—²ç½®ï¼Œå¤ªçŸ­ä¼šå
             -‡ºç°"æ•°æ®åŒ…è¢«åˆ†å‰²",é»˜è®¤count=130
  61   4                                      flag = 1;
  62   4                                      break;
  63   4                              }
  64   3                      }
  65   2                      if (num >= LENGTH - 1 || flag) break; //æ•°æ®åŒ…é•¿åº¦ä¸º19ä¸ªå­—ç¬¦,å°è¯•è¿ç»­æ¥æ”¶19ä¸ªå­—ç¬¦
  66   2              }
  67   1              *RecStr = '\0';
  68   1              return 1;
  69   1      }
  70          //å®šæ—¶å™¨1ç”¨ä½œæ³¢ç‰¹ç‡å‘ç”Ÿå™¨
  71          void Init_USART() {
  72   1              EA = 1;
  73   1              
  74   1              SCON = 0x50; //ä¸²å£æ–¹å¼1ï¼Œä½¿èƒ½æ¥æ”¶
  75   1              TMOD |= 0x20; //å®šæ—¶å™¨1å·¥ä½œæ–¹å¼2ï¼ˆ8ä½è‡ªåŠ¨é‡è£…åˆå€¼ï¼‰
  76   1              TMOD &= ~0x10;
  77   1              TH1 = 0xfa; // 9600bps
  78   1              TL1 = 0xfa;
  79   1              PCON |= 0x80; // SMOD=1
  80   1              TR1 = 1;
  81   1              TI = 0;
  82   1              RI = 0;
  83   1              // PS = 1; //æé«˜ä¸²å£ä¸­æ–­ä¼˜å…ˆçº§
  84   1              ES = 1; //å¼€å¯ä¸²å£ä¸­æ–­ä½¿èƒ½
  85   1      }
  86          //æ¯”è¾ƒæŒ‡ä»¤å¤´éƒ¨
  87          bit CompareCMD_head(char CMD_head[]) {
  88   1              unsigned char CharNum, quality;
  89   1              for (quality = 1; ; quality++)
  90   1                      if (CMD_head[quality] == '\0')
  91   1                              break;
  92   1              for (CharNum = 0; CharNum < quality; CharNum++) { //æŒ‡ä»¤é•¿åº¦ä¸º10ä¸ªå­—ç¬¦
  93   2                      if (RecvString_buf[CharNum] != CMD_head[CharNum]) {
  94   3                              return 0; //æŒ‡ä»¤å¤´éƒ¨åŒ¹é…å¤±è´¥
  95   3                      }
  96   2              }
  97   1              return 1; //æŒ‡ä»¤å¤´éƒ¨åŒ¹é…æˆåŠŸ
  98   1      }
  99          //æ¯”è¾ƒæŒ‡ä»¤å°¾éƒ¨(start:ä»å“ªé‡Œå¼€å§‹æ¯”è¾ƒï¼Œquality:æ¯”è¾ƒå¤šå°‘ä¸ªå­—ç¬¦ï¼ŒCMD_tail[]ï¼šè¦æ¯”è¾ƒç
             -š„å­—ç¬¦ä¸²)
 100          bit CompareCMD_tail(unsigned char start, unsigned char quality, char CMD_tail[]) {
 101   1              unsigned char CharNum;
 102   1              for (CharNum = 0; CharNum < quality; CharNum++) {
 103   2                      if (!(RecvString_buf[start + CharNum] == CMD_tail[CharNum])) {
 104   3                              return 0;
 105   3                      }
 106   2              }
 107   1              return 1;
 108   1      }
 109          //ç»Ÿä¸€è½¬æ¢ä¸ºå°å†™
 110          void buff_strlwr() {
C51 COMPILER V9.60.0.0   UART                                                              07/02/2021 22:57:54 PAGE 3   

 111   1              unsigned char i;
 112   1              for (i = 0; i < LENGTH; i++)
 113   1                      if (RecvString_buf[i] >= 'A' && RecvString_buf[i] <= 'Z')
 114   1                              RecvString_buf[i] += 0x20;
 115   1      }
 116          bit dealUartCommand(unsigned char command); // å£°æ˜ï¼Œå®šä¹‰åœ¨ä¸»å‡½æ•°
 117          bit Deal_UART_RecData() { //å¤„ç†ä¸²å£æ¥æ”¶æ•°æ®åŒ…å‡½æ•°ï¼ˆæˆåŠŸå¤„ç†æ•°æ®åŒ…åˆ™è¿”å›1ï¼Œå¦åˆ™è¿
             -”å›0ï¼‰
 118   1              buff_strlwr(); //å°†è¾“å…¥çš„å†…å®¹å…¨éƒ¨è½¬æ¢ä¸ºå°å†™ï¼Œè¿™æ ·ç”¨æˆ·è¾“å…¥å¤§å°å†™éƒ½æ˜¯å¯ä»¥çš„äº†
 119   1      //      PutString(RecvString_buf);
 120   1              if (CompareCMD_head(str_commandStartMeasure)) return dealUartCommand(1);
 121   1              else if (CompareCMD_head(str_commandStopMeasure)) return dealUartCommand(2);
 122   1              else return 0;
 123   1      //      return 1;
 124   1      }
 125          /************************
 126                          ä¸­æ–­å‡½æ•°
 127          ************************/
 128          //ä¸²å£ä¸­æ–­æœåŠ¡å‡½æ•°-----------
 129          void USART() interrupt 4 { //æ ‡å¿—ä½TIå’ŒRIéœ€è¦æ‰‹åŠ¨å¤ä½ï¼ŒTIå’ŒRIç½®ä½å…±ç”¨ä¸€ä¸ªä¸­æ–­å…¥å£
 130   1              if (ReceiveString()) {
 131   2                      //æ•°æ®åŒ…é•¿åº¦æ­£ç¡®åˆ™æ‰§è¡Œä»¥ä¸‹ä»£ç 
 132   2                      Deal_UART_RecData();
 133   2              } else {
 134   2                      //æ•°æ®åŒ…é•¿åº¦é”™è¯¯åˆ™æ‰§è¡Œä»¥ä¸‹ä»£ç 
 135   2                      // LED1=~LED1;
 136   2              }
 137   1              RI = 0; //æ¥æ”¶å¹¶å¤„ç†ä¸€æ¬¡æ•°æ®åæŠŠæ¥æ”¶ä¸­æ–­æ ‡å¿—æ¸…é™¤ä¸€ä¸‹ï¼Œæ‹’ç»å“åº”åœ¨ä¸­æ–­æ¥æ”¶å¿
             -™çš„æ—¶å€™å‘æ¥çš„è¯·æ±‚
 138   1      }
 139          /***************************
 140                          ä¸»å‡½æ•°
 141          ***************************/
 142          /* void main() {
 143                  EA = 1;
 144                  Init_USART(); //åˆå§‹åŒ–ä¸²å£ä¸­æ–­é€šä¿¡ï¼Œå½“ä¸²å£æ¥å—å®Œæ•°æ®åŒ…åï¼Œå¦‚æœæ£€æµ‹åˆ°æ•°æ®åŒ…åŒ
             -…å«æœ‰æ•ˆæŒ‡ä»¤ï¼Œåˆ™è‡ªåŠ¨æ‰§è¡Œå¯¹åº”çš„ä»£ç ï¼Œæ‰§è¡Œå®Œè‡ªåŠ¨è¿”å›åˆ°ä¸»å‡½æ•°ï¼Œä¸ºäº†å°½å¯èƒ½ä¸å½±å“ä¸»å‡½æ•
             -°çš„æ—¶åºï¼Œä¸²å£ä¸­æ–­å‡½æ•°çš„æ‰§è¡Œä»£ç ä¸è¦è¿‡å¤æ‚
 145                  while (1) {
 146                          //ä¸‹é¢å¯ä»¥æ”¾è¦ç»å¸¸è¿è¡Œçš„ç”¨æˆ·ä»£ç ï¼Œä½¿ç”¨PutString()å‡½æ•°æ¥å‘é€æ•°æ®åŒ…ï¼Œå¦‚PutStri
             -ng(HeartBeat);
 147                          //æ³¨:ç©ºæ ¼çš„ASCIIç æ˜¯:0x20,å›è½¦æ˜¯:0x0D
 148                  }
 149          } */


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    424    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     20    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       7
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
